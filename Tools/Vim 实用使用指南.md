# 一、Vim 核心基础

## 1.1 模式介绍（Vim 核心特性）

Vim 与普通编辑器最大的区别是存在多种模式，不同模式下操作逻辑不同，核心模式分为以下三种：

- **正常模式（Normal Mode）**：默认启动后的模式，用于导航、复制、删除、替换等快捷操作，不能直接输入文本。按 `Esc` 键可从其他模式切换至此。
    
- **插入模式（Insert Mode）**：用于输入文本，从正常模式按 `i`（光标前插入）、`I`（行首插入）、`a`（光标后插入）、`A`（行尾插入）、`o`（下一行新建插入）、`O`（上一行新建插入）可进入。
    
- **命令行模式（Command Line Mode）**：用于执行保存、退出、查找、替换等命令，从正常模式按`:`（冒号）、`/`（查找）、`?`（反向查找）可进入，按 `Esc` 退回正常模式。
    

## 1.2 启动与退出

### 启动 Vim

- 终端输入 `vim`：启动空白 Vim。
    
- 终端输入`vim 文件名`：启动 Vim 并打开指定文件（文件不存在则新建）。
    
- 终端输入 `vim +行号 文件名`：启动后直接定位到指定行（如 `vim +10 test.txt` 定位到第10行）。
    

### 退出 Vim（命令行模式执行）

- `:q`：退出（文件无修改时可用）。
    
- `:q!`：强制退出，丢弃所有修改（不保存）。
    
- `:w`：保存文件（不退出）。
    
- `:w 新文件名`：另存为新文件。
    
- `:wq` 或 `:x`：保存并退出（两者等价，`:x` 在文件无修改时不会更新文件时间戳）。
    

# 二、正常模式核心操作

## 2.1 光标导航（高效移动）

### 基础移动

- 上下左右：`k`（上）、`j`（下）、`h`（左）、`l`（右）（无需按方向键，提升效率）。
    
- 行内跳转：`0`（行首）、`$`（行尾）、`^`（行首非空字符）、`w`（下一个单词开头）、`e`（当前单词结尾）、`b`（上一个单词开头）。
    
- 页面跳转：`gg`（文件开头）、`G`（文件结尾）、`Ctrl+f`（向下翻一页）、`Ctrl+b`（向上翻一页）、`Ctrl+d`（向下翻半页）、`Ctrl+u`（向上翻半页）。
    
- 精准跳转：`行号+G`（如 `50G` 跳至第50行）、`Ctrl+o`（返回上一跳转位置）、`Ctrl+i`（前进到下一跳转位置）。
    

## 2.2 文本编辑（复制、删除、粘贴）

### 删除操作（d 命令）

- 基础删除：`x`（删除光标所在字符）、`X`（删除光标前一个字符）。
    
- 行删除：`dd`（删除当前行）、`ndd`（删除从当前行开始的n行，如 `3dd` 删除3行）、`D`（删除从光标到行尾的内容）。
    
- 按范围删除：`dw`（删除从光标到下一个单词开头）、`de`（删除从光标到当前单词结尾）、`db`（删除从光标到上一个单词开头）。
    

### 复制操作（y 命令，复制后内容存入寄存器）

- 行复制：`yy`（复制当前行）、`nyy`（复制n行，如 `2yy` 复制当前行及下一行）。
    
- 范围复制：`yw`（复制到下一个单词开头）、`ye`（复制到当前单词结尾）、`y$`（复制到行尾）、`y^`（复制到行首非空字符）。
    

### 粘贴操作（p 命令）

- `p`：将复制/删除的内容粘贴到光标后（行内容粘贴到下一行）。
    
- `P`：粘贴到光标前（行内容粘贴到上一行）。
    

### 其他编辑

- 撤销/重做：`u`（撤销上一步操作）、`Ctrl+r`（重做被撤销的操作）。
    
- 替换：`r`（替换光标所在单个字符，按r后输入新字符）、`R`（进入替换模式，连续替换光标后的字符，按Esc退出）。
    
- 缩进：`>>`（当前行右缩进）、`<<`（当前行左缩进）、`n>>`（n行右缩进）。
    

# 三、命令行模式常用命令

## 3.1 查找与替换

### 查找

- 正向查找：`/关键词`（按回车执行，`n` 跳至下一个匹配项，`N` 跳至上一个）。
    
- 反向查找：`?关键词`（`n` 跳至上一个匹配项，`N` 跳至下一个）。
    
- 取消高亮：`:noh`（清除查找结果的高亮显示）。
    

### 替换

- 基础替换：`:s/旧内容/新内容`（替换当前行第一个匹配项）。
    
- 行内全替换：`:s/旧内容/新内容/g`（g=global，当前行所有匹配项）。
    
- 范围替换：`:起始行,结束行s/旧内容/新内容/g`（如 `:1,10s/abc/def/g` 替换1-10行所有abc为def）。
    
- 全文替换：`:%s/旧内容/新内容/g`（%代表全文）。
    
- 确认替换：`:%s/旧内容/新内容/gc`（c=confirm，每个匹配项需手动确认，按y确认、n跳过、a全部替换）。
    

## 3.2 其他实用命令

- 显示行号：`:set nu`（nu=number），隐藏行号：`:set nonu`。
    
- 设置自动缩进：`:set autoindent`（适配代码编辑，新行继承上一行缩进）。
    
- 查找文件内容：`:g/关键词`（显示全文所有包含关键词的行）。
    
- 删除范围行：`:起始行,结束行d`（如 `:5,8d` 删除5-8行）。
    
- 保存权限不足时：`:w !sudo tee %`（以root权限强制保存，需输入密码）。
    
- 分屏操作：`:split 文件名`（水平分屏）、`:vsplit 文件名`（垂直分屏），分屏间切换：`Ctrl+w+方向键`。
    

# 四、高级技巧（提升效率）

## 4.1 寄存器使用

Vim 默认使用无名寄存器，可通过指定寄存器存储内容，实现多内容复制粘贴：

- 复制到指定寄存器：`"寄存器名y`（如 `"ayy` 将当前行复制到a寄存器）。
    
- 从指定寄存器粘贴：`"寄存器名p`（如 `"ap` 粘贴a寄存器内容）。
    
- 常用寄存器：0（最近复制内容）、1-9（最近删除/复制的内容历史）、+（系统剪贴板，需Vim支持剪贴板，复制 `"+y`，粘贴 `"+p`）。
    

## 4.2 宏录制（重复执行操作）

- 开始录制：`q寄存器名`（如 `qa` 开始录制，存入a寄存器）。
    
- 执行操作：录制期间正常执行编辑步骤（如删除、缩进、修改）。
    
- 结束录制：按 `q`（回到正常模式）。
    
- 重复执行：`@寄存器名`（如 `@a` 执行a寄存器的宏），`n@寄存器名`（重复n次，如 `5@a` 重复5次）。
    

## 4.3 代码编辑优化

- 括号匹配：`%`（光标在括号、引号、大括号上时，跳转至对应匹配项）。
    
- 折叠代码：`:set foldmethod=indent`（按缩进折叠），`zc`（折叠当前块）、`zo`（展开当前块）、`zR`（展开所有）、`zM`（折叠所有）。
    
- 语法高亮：`:set syntax=语言`（如 `:set syntax=python`，默认自动识别文件类型开启）。
    

# 五、常用配置（持久化优化）

Vim 配置文件为 `~/.vimrc`（用户目录下，无则新建），添加以下配置可优化使用体验：

```bash
set nu                  " 永久显示行号
set autoindent          " 自动缩进
set tabstop=4           " Tab键宽度为4个空格
set shiftwidth=4        " 缩进宽度为4个空格
set expandtab           " Tab键转为空格
set syntax=on           " 开启语法高亮
set hlsearch            " 查找结果高亮
set incsearch           " 增量查找（输入关键词时实时匹配）
set mouse=a             " 开启鼠标支持（所有模式可用）
set encoding=utf-8      " 编码格式设为UTF-8
```

添加配置后保存 `.vimrc`，重启 Vim 即可生效。

# 六、常见问题解决

- Vim 无法退出：按 `Esc` 确认回到正常模式，再输入 `:q!` 强制退出（避免误触大小写锁定）。
    
- 无法复制到系统剪贴板：安装支持剪贴板的 Vim 版本（如 `sudo apt install vim-gtk` Ubuntu），使用 `"+y`/`"+p` 操作。
    
- 语法高亮不生效：确保配置中 `set syntax=on`，且文件后缀正确（Vim 按后缀识别语言）。